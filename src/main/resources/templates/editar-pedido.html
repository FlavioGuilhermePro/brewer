<!DOCTYPE html>
<html lang="pt-BR" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Editar Pedido - Brewer</title>
    <link rel="stylesheet" th:href="@{/style.css}">
    <script src="/script.js"></script>
</head>
<body>

<nav class="topbar">
    <button id="menu-toggle" class="menu-toggle">
        <i class="fas fa-bars"></i>
    </button>
    <a th:href="@{/dashboard}" class="topbar-logo">
        <img th:src="@{/images/logo-brewer.png}" alt="Logo Brewer Admin">
        Brewer
    </a>
    <form th:action="@{/logout}" method="post" style="display: inline;">
        <button type="submit" class="btn-logout" title="Sair" style="background: none; border: none; color: var(--cor-white); font-size: 0.95em; font-weight: 600; padding: 8px 16px; border-radius: 6px; transition: background-color 0.2s ease-in-out;">
            Sair
        </button>
    </form>
</nav>

<div class="layout-container">
    <aside class="sidebar">
        <nav class="sidebar-nav">
            <ul>
                <li><a th:href="@{/dashboard}" class="active">Dashboard</a></li>
                <li><a th:href="@{/brewer/listar}">Estoque de Cervejas</a></li>
                <li><a th:href="@{/cliente/listar}">Cadastro de Clientes</a></li>
                <li><a th:href="@{/pedido/listar}" class="active">Gerenciar Pedidos</a></li>
            </ul>
        </nav>
    </aside>

    <main class="content-area">
        <div class="page-header">
            <h1>Editar Pedido #<span th:text="${pedido.id}">123</span></h1>
            <p><strong>Cliente:</strong> <span th:text="${pedido.cliente.nome}">Nome do Cliente</span></p>
            <p><strong>Data:</strong> <span th:text="${#temporals.format(pedido.dataPedido, 'dd/MM/yyyy')}">01/01/2025</span></p>
            <p><strong>Status:</strong> <span th:text="${pedido.status}" style="color: orange; font-weight: bold;">PENDENTE</span></p>
        </div>

        <!-- Mensagens -->
        <div th:if="${mensagem}" class="alert alert-success">
            <span th:text="${mensagem}">Operação realizada com sucesso!</span>
        </div>
        <div th:if="${erro}" class="alert alert-error">
            <span th:text="${erro}">Erro na operação!</span>
        </div>

        <!-- Formulário para editar pedido -->
        <div class="card">
            <h2>Informações do Pedido</h2>
            <form th:action="@{/pedido/atualizar}" th:object="${pedido}" method="post">
                <input type="hidden" th:field="*{id}">

                <div class="form-group">
                    <label>Endereço de Entrega:</label>
                    <input type="text" th:field="*{enderecoEntrega}" placeholder="Endereço completo para entrega">
                </div>

                <div class="form-group">
                    <label>Observações:</label>
                    <textarea th:field="*{observacoes}" rows="4" placeholder="Observações adicionais sobre o pedido"></textarea>
                </div>

                <button type="submit" class="btn-primary">Salvar Alterações</button>
                <a th:href="@{/pedido/listar}">
                    <button type="button" class="btn-secondary">Cancelar</button>
                </a>
            </form>
        </div>

        <!-- Lista de itens do pedido -->
        <div class="card" th:if="${pedido.itens != null and !#lists.isEmpty(pedido.itens)}">
            <h2>Itens do Pedido</h2>
            <table>
                <thead>
                <tr>
                    <th>Cerveja</th>
                    <th>Quantidade</th>
                    <th>Valor Unitário</th>
                    <th>Valor Total</th>
                    <th>Ações</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="item : ${pedido.itens}">
                    <td th:text="${item.cerveja.nome}">Nome da Cerveja</td>
                    <td th:text="${item.quantidade}">1</td>
                    <td th:text="'R$ ' + ${#numbers.formatDecimal(item.valorUnitario, 1, 'COMMA', 2, 'POINT')}">R$ 5,00</td>
                    <td th:text="'R$ ' + ${#numbers.formatDecimal(item.valorTotal, 1, 'COMMA', 2, 'POINT')}">R$ 5,00</td>
                    <td>
                        <form th:action="@{/pedido/remover-item}" method="post" style="display:inline;">
                            <input type="hidden" name="pedidoId" th:value="${pedido.id}">
                            <input type="hidden" name="itemId" th:value="${item.id}">
                            <button type="submit" class="btn-delete" onclick="return confirm('Deseja remover este item?')">Remover</button>
                        </form>
                    </td>
                </tr>
                </tbody>
                <tfoot>
                <tr style="font-weight: bold; background-color: #F5F5F5;">
                    <td colspan="3" style="text-align: right;">TOTAL DO PEDIDO:</td>
                    <td th:text="'R$ ' + ${#numbers.formatDecimal(pedido.total, 1, 'COMMA', 2, 'POINT')}">R$ 0,00</td>
                    <td></td>
                </tr>
                </tfoot>
            </table>
        </div>
    </main>
</div>

</body>
</html>