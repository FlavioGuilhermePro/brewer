<!DOCTYPE html>
<html lang="pt-BR" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Adicionar Itens - Pedido</title>
    <link rel="stylesheet" th:href="@{/style.css}">
</head>
<body>

<nav class="topbar">
    <a th:href="@{/dashboard}" class="topbar-logo">
        <img th:src="@{/images/logo-brewer.png}" alt="Logo Brewer Admin">
        Brewer Admin
    </a>
    <form th:action="@{/logout}" method="post" style="display: inline;">
        <button type="submit" class="btn-logout" title="Sair" style="background: none; border: none; color: var(--cor-white); font-size: 0.95em; font-weight: 600; padding: 8px 16px; border-radius: 6px; transition: background-color 0.2s ease-in-out;">
            Sair
        </button>
    </form>
</nav>

<div class="layout-container">
    <aside class="sidebar">
        <nav class="sidebar-nav">
            <ul>
                <li><a th:href="@{/dashboard}" class="active">Dashboard</a></li>
                <li><a th:href="@{/brewer/listar}">Estoque de Cervejas</a></li>
                <li><a th:href="@{/cliente/listar}">Cadastro de Clientes</a></li>
                <li><a th:href="@{/pedido/listar}" class="active">Gerenciar Pedidos</a></li>
            </ul>
        </nav>
    </aside>

    <main class="content-area">
        <div class="page-header">
            <h1>Pedido #<span th:text="${pedido.id}">123</span></h1>
            <p><strong>Cliente:</strong> <span th:text="${pedido.cliente.nome}">Nome do Cliente</span></p>
            <p><strong>Data:</strong> <span th:text="${#temporals.format(pedido.dataPedido, 'dd/MM/yyyy')}">01/01/2025</span></p>
            <p><strong>Total:</strong> R$ <span th:text="${#numbers.formatDecimal(pedido.total, 1, 'COMMA', 2, 'POINT')}">0,00</span></p>
            <p><strong>Status:</strong> <span th:text="${pedido.status}" style="color: orange; font-weight: bold;">PENDENTE</span></p>
        </div>

        <!-- Mensagens -->
        <div th:if="${mensagem}" class="alert alert-success">
            <span th:text="${mensagem}">Opera√ß√£o realizada com sucesso!</span>
        </div>
        <div th:if="${erro}" class="alert alert-error">
            <span th:text="${erro}">Erro na opera√ß√£o!</span>
        </div>

        <!-- Verificar se h√° cervejas dispon√≠veis -->
        <div th:if="${#lists.isEmpty(cervejas)}" class="alert alert-warning">
            <p><strong>‚ö†Ô∏è N√£o h√° cervejas cadastradas no estoque.</strong></p>
            <p>Para adicionar itens ao pedido, primeiro cadastre cervejas no sistema.</p>
            <a th:href="@{/brewer/listar}" class="btn-primary">Cadastrar Cervejas</a>
        </div>

        <!-- Formul√°rio para adicionar item -->
        <div class="card" th:if="${!#lists.isEmpty(cervejas)}">
            <h2>Adicionar Cerveja ao Pedido</h2>
            <form th:action="@{/pedido/adicionar-item}" method="post">
                <input type="hidden" name="pedidoId" th:value="${pedido.id}">

                <div class="form-group">
                    <label>Cerveja:</label>
                    <select name="cervejaId" required>
                        <option value="">-- Escolha uma cerveja --</option>
                        <option th:each="cerveja : ${cervejas}"
                                th:value="${cerveja.id}"
                                th:text="${cerveja.nome + ' - Estoque: ' + cerveja.quantidadeEstoque + ' - R$ ' + #numbers.formatDecimal(cerveja.valorVenda, 1, 'COMMA', 2, 'POINT')}"
                                th:disabled="${cerveja.quantidadeEstoque == 0}">
                        </option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Quantidade:</label>
                    <input type="number" name="quantidade" min="1" value="1" required>
                </div>

                <button type="submit" class="btn-primary">Adicionar Item</button>
                <a th:href="@{/pedido/editar/{id}(id=${pedido.id})}">
                    <button type="button" class="btn-secondary">Editar Informa√ß√µes</button>
                </a>
            </form>
        </div>

        <!-- Lista de itens j√° adicionados -->
        <div class="card" th:if="${pedido.itens != null and !#lists.isEmpty(pedido.itens)}">
            <h2>Itens do Pedido</h2>
            <table>
                <thead>
                <tr>
                    <th>Cerveja</th>
                    <th>Quantidade</th>
                    <th>Valor Unit√°rio</th>
                    <th>Valor Total</th>
                    <th>A√ß√µes</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="item : ${pedido.itens}">
                    <td th:text="${item.cerveja.nome}">Nome da Cerveja</td>
                    <td th:text="${item.quantidade}">1</td>
                    <td th:text="'R$ ' + ${#numbers.formatDecimal(item.valorUnitario, 1, 'COMMA', 2, 'POINT')}">R$ 5,00</td>
                    <td th:text="'R$ ' + ${#numbers.formatDecimal(item.valorTotal, 1, 'COMMA', 2, 'POINT')}">R$ 5,00</td>
                    <td>
                        <form th:action="@{/pedido/remover-item}" method="post" style="display:inline;">
                            <input type="hidden" name="pedidoId" th:value="${pedido.id}">
                            <input type="hidden" name="itemId" th:value="${item.id}">
                            <button type="submit" class="btn-delete" onclick="return confirm('Deseja remover este item?')">Remover</button>
                        </form>
                    </td>
                </tr>
                </tbody>
                <tfoot>
                <tr style="font-weight: bold; background-color: #F5F5F5;">
                    <td colspan="3" style="text-align: right;">TOTAL DO PEDIDO:</td>
                    <td th:text="'R$ ' + ${#numbers.formatDecimal(pedido.total, 1, 'COMMA', 2, 'POINT')}">R$ 0,00</td>
                    <td></td>
                </tr>
                </tfoot>
            </table>
        </div>

        <!-- Aviso se n√£o tem itens -->
        <div class="card" th:if="${pedido.itens == null or #lists.isEmpty(pedido.itens)}">
            <div class="alert alert-warning">
                <p><strong>üì¶ Nenhum item adicionado ainda</strong></p>
                <p>Adicione pelo menos uma cerveja para poder finalizar o pedido.</p>
            </div>
        </div>

        <!-- Resumo e bot√£o finalizar -->
        <div class="card">
            <h2>Finalizar Pedido</h2>

            <form th:action="@{/pedido/finalizar}" method="post" style="margin-top: 15px;">
                <input type="hidden" name="pedidoId" th:value="${pedido.id}">
                <button type="submit" class="btn-primary"
                        th:disabled="${pedido.itens == null or #lists.isEmpty(pedido.itens)}"
                        onclick="return confirm('Deseja finalizar este pedido? O estoque ser√° atualizado e n√£o ser√° poss√≠vel adicionar mais itens.')">
                    Finalizar Pedido
                </button>

                <a th:href="@{/pedido/listar}">
                    <button type="button" class="btn-secondary">Voltar para Pedidos</button>
                </a>
            </form>

            <p th:if="${pedido.itens == null or #lists.isEmpty(pedido.itens)}" style="color: #FF9800; margin-top: 10px;">
                ‚ö†Ô∏è Adicione pelo menos um item para poder finalizar o pedido.
            </p>
        </div>
    </main>
</div>

</body>
</html>